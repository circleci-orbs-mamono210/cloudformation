  description: |
    Install and configure aws-cli and execute aws cloudformation commands

  executor:
    name: default

  parameters:
    stack-name:
      description: |
        CloudFormation stack name
      type: string

    template-file-path:
      description: |
        CloudFormation template file path
      type: string

    branch:
      description: |
        Git branch of retrieving GitHub URL of CloudFormation
         template file
      type: string
      default: master

    extra-arguments:
      description: |
        Optional additional arguments to pass to the `aws 
        cloudformation create-stack` command
      type: string
      default: ""

    git-url:
      description: |
        GitHub URL to retrieve CloudFormation template
      type: string
      default: ""

    aws-access-key-id:
      description: |
        AWS access key id for IAM role. Set this to the name of
        the environment variable you will use to hold this
        value, i.e. AWS_ACCESS_KEY.
      type: env_var_name
      default: AWS_ACCESS_KEY_ID

    aws-secret-access-key:
      description: |
        AWS secret key for IAM role. Set this to the name of
        the environment variable you will use to hold this
        value, i.e. $AWS_SECRET_ACCESS_KEY.
      type: env_var_name
      default: AWS_SECRET_ACCESS_KEY

    aws-region:
      description: |
        Env var of AWS region to operate in
        (defaults to AWS_DEFAULT_REGION)
      type: env_var_name
      default: AWS_DEFAULT_REGION

    profile-name:
      description: Profile name to be configured.
      type: string
      default: "default"

    configure-default-region:
      description: |
        Some AWS actions don't require a region; set this to false if you do not want to store a default region in ~/.aws/config
      type: boolean
      default: true

  steps:
    - aws-cli/install

    - aws-cli/configure:
        aws-access-key-id: <<parameters.aws-access-key-id>>
        aws-secret-access-key: <<parameters.aws-secret-access-key>>
        aws-region: <<parameters.aws-region>>
        profile-name: <<parameters.profile-name>>
        configure-default-region: <<parameters.configure-default-region>>

    - checkout

    - create-stack:
        stack-name: <<parameters.stack-name>>
        template-file-path: <<parameters.template-file-path>>
        extra-arguments: <<parameters.extra-arguments>>
        git-url: <<parameters.git-url>>
        branch: <<parameters.branch>>
